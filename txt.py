import streamlit as st
import pandas as pd
from difflib import get_close_matches

st.title("ğŸ± ììœ  ì…ë ¥ ì‹ë‹¨ ë¶„ì„ê¸°")
st.write("ì•„ë¬´ ìŒì‹ì´ë‚˜ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì¹¼ë¡œë¦¬ì™€ ì˜ì–‘ì†Œë¥¼ ì¶”ì •í•´ë“œë ¤ìš”!")

# âœ… ìŒì‹-ì˜ì–‘ì†Œ ë°ì´í„°ì…‹ (ì˜ˆì‹œ)
food_db = {
    "ë°¥": {"ì¹¼ë¡œë¦¬": 300, "íƒ„ìˆ˜í™”ë¬¼": 65, "ë‹¨ë°±ì§ˆ": 6, "ì§€ë°©": 0.5},
    "ê¹€ì¹˜": {"ì¹¼ë¡œë¦¬": 30, "íƒ„ìˆ˜í™”ë¬¼": 7, "ë‹¨ë°±ì§ˆ": 2, "ì§€ë°©": 0.2},
    "ë‹­ê°€ìŠ´ì‚´": {"ì¹¼ë¡œë¦¬": 165, "íƒ„ìˆ˜í™”ë¬¼": 0, "ë‹¨ë°±ì§ˆ": 31, "ì§€ë°©": 3.6},
    "ë°”ë‚˜ë‚˜": {"ì¹¼ë¡œë¦¬": 90, "íƒ„ìˆ˜í™”ë¬¼": 23, "ë‹¨ë°±ì§ˆ": 1, "ì§€ë°©": 0.3},
    "ê³„ë€": {"ì¹¼ë¡œë¦¬": 70, "íƒ„ìˆ˜í™”ë¬¼": 0.6, "ë‹¨ë°±ì§ˆ": 6, "ì§€ë°©": 5},
    "ì‚¬ê³¼": {"ì¹¼ë¡œë¦¬": 52, "íƒ„ìˆ˜í™”ë¬¼": 14, "ë‹¨ë°±ì§ˆ": 0.3, "ì§€ë°©": 0.2},
    "ìš°ìœ ": {"ì¹¼ë¡œë¦¬": 100, "íƒ„ìˆ˜í™”ë¬¼": 12, "ë‹¨ë°±ì§ˆ": 8, "ì§€ë°©": 4.5},
    "ê³ êµ¬ë§ˆ": {"ì¹¼ë¡œë¦¬": 130, "íƒ„ìˆ˜í™”ë¬¼": 30, "ë‹¨ë°±ì§ˆ": 2, "ì§€ë°©": 0.1},
    "í–„ë²„ê±°": {"ì¹¼ë¡œë¦¬": 500, "íƒ„ìˆ˜í™”ë¬¼": 40, "ë‹¨ë°±ì§ˆ": 25, "ì§€ë°©": 30},
    "í”¼ì": {"ì¹¼ë¡œë¦¬": 285, "íƒ„ìˆ˜í™”ë¬¼": 36, "ë‹¨ë°±ì§ˆ": 12, "ì§€ë°©": 10}
}

recommended = {
    "ì¹¼ë¡œë¦¬": 2000,
    "íƒ„ìˆ˜í™”ë¬¼": 300,
    "ë‹¨ë°±ì§ˆ": 50,
    "ì§€ë°©": 70
}

# âœ… ì‚¬ìš©ì ì…ë ¥
st.subheader("ğŸ“ ì˜¤ëŠ˜ ë¨¹ì€ ìŒì‹ ì…ë ¥")
food_input = st.text_area("ì‰¼í‘œë¡œ êµ¬ë¶„í•´ì„œ ììœ ë¡­ê²Œ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë°¥, ì¹˜í‚¨, ë°”ë‚˜ë‚˜)", height=100)

if st.button("ë¶„ì„ ì‹œì‘"):
    food_list = [f.strip() for f in food_input.split(",")]
    total = {"ì¹¼ë¡œë¦¬": 0, "íƒ„ìˆ˜í™”ë¬¼": 0, "ë‹¨ë°±ì§ˆ": 0, "ì§€ë°©": 0}
    matched_foods = []

    for food in food_list:
        match = get_close_matches(food, food_db.keys(), n=1, cutoff=0.6)
        if match:
            matched = match[0]
            info = food_db[matched]
            for key in total:
                total[key] += info[key]
            matched_foods.append({**{"ì…ë ¥": food, "ë§¤ì¹­ëœ ìŒì‹": matched}, **info})
        else:
            st.warning(f"â— '{food}'ì€ ìœ ì‚¬í•œ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”.")

    # âœ… ê²°ê³¼ ì¶œë ¥
    if matched_foods:
        st.subheader("ğŸ“Š ë§¤ì¹­ëœ ìŒì‹ê³¼ ì˜ì–‘ ì •ë³´")
        df = pd.DataFrame(matched_foods)
        st.dataframe(df)

        st.subheader("ğŸ“ˆ ì´ ì„­ì·¨ëŸ‰ vs ê¶Œì¥ëŸ‰")
        compare_df = pd.DataFrame({
            "ì„­ì·¨ëŸ‰": [total[k] for k in recommended],
            "ê¶Œì¥ëŸ‰": [recommended[k] for k in recommended]
        }, index=recommended.keys())
        st.bar_chart(compare_df)

        st.subheader("ğŸ’¡ ì‹ìŠµê´€ ê°œì„  íŒ")
        for key in recommended:
            intake = total[key]
            need = recommended[key]
            if intake < need * 0.8:
                st.write(f"ğŸ”» {key} ì„­ì·¨ê°€ ë¶€ì¡±í•´ìš”. {key}ì´ í’ë¶€í•œ ì‹í’ˆì„ ë” ë“œì…”ë³´ì„¸ìš”.")
            elif intake > need * 1.2:
                st.write(f"ğŸ”º {key} ì„­ì·¨ê°€ ë§ì•„ìš”. ê³¼ë‹¤ ì„­ì·¨ë¥¼ ì£¼ì˜í•˜ì„¸ìš”.")
            else:
                st.write(f"âœ… {key} ì„­ì·¨ê°€ ì ì ˆí•´ìš”. ì˜í•˜ê³  ìˆì–´ìš”!")

