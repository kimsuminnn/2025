# app.py
# -*- coding: utf-8 -*-
import re
import json
from typing import Dict, Tuple, List

import numpy as np
import pandas as pd
import streamlit as st
import altair as alt

st.set_page_config(page_title="고2 식단 · 영양 분석기", page_icon="🥗", layout="wide")

# -----------------------------
# 1) 음식 데이터베이스 (15개 열 고정)
# -----------------------------
def load_food_db() -> pd.DataFrame:
    data = [
        # food, unit, per_unit, kcal, carb, protein, fat, fiber,
        # sugar, vit_a, vit_c, calcium, iron, sodium, potassium
        ("밥(백미) 1공기", "공기", 1, 300, 66, 6, 0.6, 1.0, 0.1, 0, 0, 10, 2, 120, 26),
        ("잡곡밥 1공기", "공기", 1, 310, 64, 7, 2.5, 4.5, 1.0, 0, 0, 15, 2.5, 180, 30),
        ("김치 50g", "접시", 1, 10, 2, 1, 0.2, 1.6, 0.5, 8, 9, 40, 0.4, 300, 90),
        ("달걀 1개(50g)", "개", 1, 70, 0.6, 6, 5, 0, 0.2, 75, 0, 28, 0.9, 60, 70),
        ("닭가슴살 100g", "인분", 1, 165, 0, 31, 3.6, 0, 0, 13, 0, 12, 1, 70, 256),
        ("돼지불고기 150g", "인분", 1, 330, 12, 24, 20, 2.0, 7, 15, 0, 40, 2.4, 600, 450),
        ("소불고기 150g", "인분", 1, 340, 15, 23, 20, 1.5, 6, 0, 0, 30, 2.8, 550, 420),
        ("두부 150g", "모", 1, 120, 4, 12, 7, 2, 1.5, 0, 0, 250, 2.7, 5, 220),
        ("우유 1컵(200ml)", "컵", 1, 125, 9.6, 6.6, 6.8, 0, 12, 0, 0, 230, 0.1, 100, 370),
        ("요거트 1개(100g)", "개", 1, 60, 8, 3, 2, 0, 2, 2, 0, 110, 0.1, 50, 150),
        ("바나나 1개(100g)", "개", 1, 89, 23, 1.1, 0.3, 2.6, 12, 3, 9, 5, 0.3, 1, 358),
        ("사과 1개(150g)", "개", 1, 80, 21, 0.3, 0.2, 3.6, 16, 3, 5, 10, 0.1, 1, 195),
        ("감귤/오렌지 1개(130g)", "개", 1, 62, 15.5, 1.2, 0.2, 3.1, 12, 70, 40, 50, 0.1, 1, 240),
        ("고구마 150g", "개", 1, 180, 42, 3, 0.3, 5.0, 13, 960, 30, 40, 0.8, 20, 700),
        ("시금치나물 100g", "인분", 1, 35, 5, 3, 0.5, 2.4, 0.4, 470, 28, 90, 1.0, 150, 560),
        ("브로콜리 100g", "인분", 1, 34, 7, 3, 0.4, 2.6, 1.7, 31, 47, 50, 0.7, 33, 316),
        ("라면 1개", "개", 1, 500, 77, 10, 17, 4, 3, 0, 0, 30, 5, 1700, 250),
        ("김밥 1줄", "줄", 1, 350, 55, 10, 8, 3, 4, 80, 6, 50, 2, 900, 200),
        ("비빔밥 1그릇", "그릇", 1, 550, 80, 18, 15, 6, 9, 200, 15, 80, 4, 1200, 400),
        ("떡볶이 1인분(300g)", "인분", 1, 450, 90, 9, 6, 3, 14, 20, 4, 60, 1.8, 1400, 300),
        ("치킨 2조각", "인분", 1, 430, 23, 31, 24, 1, 3, 40, 0, 25, 2, 350, 300),
        ("햄버거 1개", "개", 1, 500, 45, 25, 26, 3, 7, 80, 1, 200, 4, 700, 350),
        ("피자 1조각", "조각", 1, 285, 33, 12, 11, 2, 3, 80, 2, 180, 2, 600, 180),
        ("콜라 1캔(250ml)", "캔", 1, 105, 26, 0, 0, 0, 26, 0, 0, 0, 0, 15, 0),
        ("물 1컵", "컵", 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
    ]
    cols = ["food", "unit", "per_unit", "kcal", "carb", "protein", "fat", "fiber",
            "sugar", "vit_a", "vit_c", "calcium", "iron", "sodium", "potassium"]
    df = pd.DataFrame(data, columns=cols)
    return df

FOOD_DB = load_food_db()
FOOD_LOOKUP = {re.sub(r"\s*\(.+?\)", "", row.food).strip(): row for _, row in FOOD_DB.iterrows()}

# -----------------------------
# 나머지 코드는 그대로 (영양소 권장량, 분석, 시각화, 개선 팁, UI)
# -----------------------------

# (중략: 앞서 드린 코드의 2)~끝까지 그대로 사용)
# ↓↓↓ 여기에 위에서 드린 나머지 전체 코드 붙여 넣으면 됩니다 ↓↓↓
